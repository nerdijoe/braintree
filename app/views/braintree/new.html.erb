<h1>Braintree#new</h1>
<p>Find me in app/views/braintree/new.html.erb</p>


<div class="demo-frame">

  <%= form_for :checkout_form, url: braintree_checkout_path, html: {id: "cardForm" } do |form| %>

  <%= form.label :card_number, "Credit Card Number", html: {class: "hosted-fields--label"}  %>
  <div id="card-number" class="hosted-field"></div>

  <%= form.label :expiration_date, "Expiration Date", html: {class: "hosted-fields--label"} %>
  <div id="expiration-date" class="hosted-field"></div>

  <%= form.label :cvv, "CVV", html: {class: "hosted-fields--label"} %>
  <div id="cvv" class="hosted-field"></div>

  <%= form.hidden_field :payment_method_nonce, value: 'fake-valid-visa-nonce' %>

  <div class ="button-container">
    <%= form.submit "Purchase", disabled: false, class: "btn btn-primary", id: "submit-payment-btn" %>
  </div>

  <% end %>
</div>


<!-- Load the Client component. -->
<script src="https://js.braintreegateway.com/web/3.6.3/js/client.min.js"></script>
<!-- Load the Hosted Fields component. -->
<script src="https://js.braintreegateway.com/web/3.6.3/js/hosted-fields.min.js"></script>



<script>

var form = document.querySelector('#cardForm');
// var authorization = 'sandbox_g42y39zw_348pk9cgf3bgyw2b';
var authorization = '<%= @client_token %>';
var submit = document.querySelector("#submit-payment-btn");

braintree.client.create({
  authorization: authorization
}, function(err, clientInstance) {
  if (err) {
    console.error(err);
    return;
  }
  createHostedFields(clientInstance);
});

function createHostedFields(clientInstance) {
  braintree.hostedFields.create({
    client: clientInstance,
    styles: {
      'input': {
        'font-size': '16px',
        'font-family': 'courier, monospace',
        'font-weight': 'lighter',
        'color': '#ccc'
      },
      ':focus': {
        'color': 'black'
      },
      '.valid': {
        'color': '#8bdda8'
      }
    },
    fields: {
      number: {
        selector: '#card-number',
        placeholder: '4111 1111 1111 1111'
      },
      cvv: {
        selector: '#cvv',
        placeholder: '123'
      },
      expirationDate: {
        selector: '#expiration-date',
        placeholder: 'MM/YYYY'
      }
    }
  }, function (err, hostedFieldsInstance) {
    var teardown = function (event) {
      event.preventDefault();
      alert('Submit your nonce to your server here!');
      hostedFieldsInstance.teardown(function () {
        createHostedFields(clientInstance);
        form.removeEventListener(submit, teardown, false);
      });
    };

    form.addEventListener(submit, teardown, false);
  });
}

</script>
